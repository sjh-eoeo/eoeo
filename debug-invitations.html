<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆëŒ€ ì•Œë¦¼ ë””ë²„ê¹… v2</title>YPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œë¦¼ ë””ë²„ê¹… ë„êµ¬</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 { color: #00ffff; }
        .section {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 3px;
        }
        button:hover {
            background: #00ffff;
        }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .warning { color: #ffff00; }
        .info { color: #00ffff; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #00ff00;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #003300;
        }
        .match { color: #00ff00; }
        .nomatch { color: #ff0000; }
    </style>
</head>
<body>
    <h1>ğŸ” í”„ë¡œì íŠ¸ ì´ˆëŒ€ ì•Œë¦¼ ë””ë²„ê¹… ë„êµ¬</h1>

    <div class="section">
        <h2>1ï¸âƒ£ í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì í™•ì¸</h2>
        <button onclick="checkCurrentUser()">ë‚´ ì •ë³´ í™•ì¸</button>
        <pre id="current-user"></pre>
    </div>

    <div class="section">
        <h2>2ï¸âƒ£ ëª¨ë“  ì´ˆëŒ€ ëª©ë¡ í™•ì¸</h2>
        <button onclick="checkAllInvitations()">ì „ì²´ ì´ˆëŒ€ ë³´ê¸°</button>
        <div id="all-invitations"></div>
    </div>

    <div class="section">
        <h2>3ï¸âƒ£ ë‚´ ì´ˆëŒ€ ë§¤ì¹­ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testMatching()">ë§¤ì¹­ í…ŒìŠ¤íŠ¸</button>
        <div id="matching-result"></div>
    </div>

    <div class="section">
        <h2>4ï¸âƒ£ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° í™•ì¸</h2>
        <button onclick="checkProjectMetadata()">í”„ë¡œì íŠ¸ ëª©ë¡ ë³´ê¸°</button>
        <div id="project-metadata"></div>
    </div>

    <div class="section">
        <h2>5ï¸âƒ£ Firestore ì‚¬ìš©ì ëª©ë¡ (ìˆ˜ë™ ì…ë ¥ í•„ìš”)</h2>
        <p class="info">Admin í˜ì´ì§€ â†’ í”„ë¡œì íŠ¸ ì¶”ê°€ â†’ ì°¸ì—¬ì ë“œë¡­ë‹¤ìš´ì—ì„œ í™•ì¸ ê°€ëŠ¥</p>
        <textarea id="firestore-users" rows="10" style="width: 100%; background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 10px;" placeholder='[
  {"email": "sjh@egongegong.com", "name": "SJH", "role": "admin"},
  {"email": "junhoi90@gmail.com", "name": "Junhoi", "role": "user"}
]'></textarea>
        <button onclick="compareWithFirestore()">Firestoreì™€ ë¹„êµ</button>
        <div id="firestore-comparison"></div>
    </div>

    <div class="section">
        <h2>6ï¸âƒ£ ê°•ì œ ì´ˆëŒ€ ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)</h2>
        <input type="text" id="test-email" placeholder="ì´ˆëŒ€í•  ì´ë©”ì¼ (ì˜ˆ: junhoi90@gmail.com)" style="width: 300px; background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 8px;">
        <button onclick="createTestInvitation()">í…ŒìŠ¤íŠ¸ ì´ˆëŒ€ ìƒì„±</button>
        <pre id="test-result"></pre>
    </div>

    <div class="section">
        <h2>7ï¸âƒ£ ë°ì´í„° ì´ˆê¸°í™”</h2>
        <button onclick="clearInvitations()" style="background: #ff0000; color: #fff;">ì´ˆëŒ€ ë°ì´í„° ì‚­ì œ</button>
        <button onclick="clearAllData()" style="background: #ff6600; color: #fff;">ëª¨ë“  ë°ì´í„° ì‚­ì œ (ì£¼ì˜!)</button>
        <pre id="clear-result"></pre>
    </div>

    <script>
        function checkCurrentUser() {
            try {
                const authStorage = localStorage.getItem('auth-storage');
                if (!authStorage) {
                    document.getElementById('current-user').innerHTML = '<span class="error">âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</span>';
                    return;
                }
                
                const auth = JSON.parse(authStorage);
                const user = auth?.state?.appUser;
                
                if (!user) {
                    document.getElementById('current-user').innerHTML = '<span class="error">âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ</span>';
                    return;
                }
                
                const normalized = user.email?.trim().toLowerCase();
                
                document.getElementById('current-user').innerHTML = `
<span class="success">âœ… ë¡œê·¸ì¸ë¨</span>

<span class="info">ğŸ“§ ì´ë©”ì¼ (ì›ë³¸):</span> ${user.email}
<span class="info">ğŸ“§ ì´ë©”ì¼ (ì •ê·œí™”):</span> ${normalized}
<span class="info">ğŸ‘¤ ì´ë¦„:</span> ${user.name || 'N/A'}
<span class="info">ğŸ”‘ ì—­í• :</span> ${user.role || 'N/A'}
<span class="info">ğŸ†” UID:</span> ${user.uid || 'N/A'}

<span class="warning">âš ï¸  ì•Œë¦¼ì€ ì •ê·œí™”ëœ ì´ë©”ì¼ë¡œ ë§¤ì¹­ë©ë‹ˆë‹¤!</span>
                `;
            } catch (error) {
                document.getElementById('current-user').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function checkAllInvitations() {
            try {
                const invitationsStr = localStorage.getItem('project-invitations');
                if (!invitationsStr) {
                    document.getElementById('all-invitations').innerHTML = '<span class="warning">âš ï¸  ì €ì¥ëœ ì´ˆëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤</span>';
                    return;
                }
                
                const invitations = JSON.parse(invitationsStr);
                
                if (invitations.length === 0) {
                    document.getElementById('all-invitations').innerHTML = '<span class="warning">âš ï¸  ì´ˆëŒ€ ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</span>';
                    return;
                }
                
                let html = `<span class="success">âœ… ì´ ${invitations.length}ê°œì˜ ì´ˆëŒ€</span>`;
                html += `<table>
                    <tr>
                        <th>ë²ˆí˜¸</th>
                        <th>ì´ˆëŒ€ëœ ì´ë©”ì¼</th>
                        <th>í”„ë¡œì íŠ¸</th>
                        <th>ë¸Œëœë“œ</th>
                        <th>ì´ˆëŒ€í•œ ì‚¬ëŒ</th>
                        <th>ë‚ ì§œ</th>
                        <th>ì½ìŒ</th>
                    </tr>`;
                
                invitations.forEach((inv, idx) => {
                    const normalized = inv.invitedEmail.trim().toLowerCase();
                    html += `<tr>
                        <td>${idx + 1}</td>
                        <td>
                            <div>${inv.invitedEmail}</div>
                            <div class="info" style="font-size: 0.9em;">(ì •ê·œí™”: ${normalized})</div>
                        </td>
                        <td>${inv.projectName}</td>
                        <td>${inv.brand}</td>
                        <td>${inv.invitedBy}</td>
                        <td>${new Date(inv.invitedAt).toLocaleString('ko-KR')}</td>
                        <td>${inv.isRead ? 'âœ…' : 'âŒ'}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('all-invitations').innerHTML = html;
            } catch (error) {
                document.getElementById('all-invitations').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function testMatching() {
            try {
                const authStorage = localStorage.getItem('auth-storage');
                const invitationsStr = localStorage.getItem('project-invitations');
                
                if (!authStorage) {
                    document.getElementById('matching-result').innerHTML = '<span class="error">âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</span>';
                    return;
                }
                
                if (!invitationsStr) {
                    document.getElementById('matching-result').innerHTML = '<span class="warning">âš ï¸  ì €ì¥ëœ ì´ˆëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤</span>';
                    return;
                }
                
                const auth = JSON.parse(authStorage);
                const user = auth?.state?.appUser;
                const invitations = JSON.parse(invitationsStr);
                
                const myEmail = user.email?.trim().toLowerCase();
                
                let html = `<span class="info">ğŸ” ë§¤ì¹­ í…ŒìŠ¤íŠ¸: ${myEmail}</span><br><br>`;
                html += '<table><tr><th>ì´ˆëŒ€ ì´ë©”ì¼</th><th>ì •ê·œí™”</th><th>ë§¤ì¹­</th><th>í”„ë¡œì íŠ¸</th></tr>';
                
                let matchCount = 0;
                
                invitations.forEach(inv => {
                    const invEmail = inv.invitedEmail.trim().toLowerCase();
                    const match = invEmail === myEmail;
                    
                    if (match) matchCount++;
                    
                    html += `<tr class="${match ? 'match' : 'nomatch'}">
                        <td>${inv.invitedEmail}</td>
                        <td>${invEmail}</td>
                        <td>${match ? 'âœ… ë§¤ì¹­ë¨' : 'âŒ ë¶ˆì¼ì¹˜'}</td>
                        <td>${inv.projectName}</td>
                    </tr>`;
                });
                
                html += '</table>';
                html += `<br><span class="${matchCount > 0 ? 'success' : 'error'}">
                    ${matchCount > 0 ? 'âœ…' : 'âŒ'} ì´ ${matchCount}ê°œì˜ ë§¤ì¹­ëœ ì´ˆëŒ€
                </span>`;
                
                if (matchCount === 0) {
                    html += `<br><br><span class="warning">âš ï¸  ê°€ëŠ¥í•œ ì›ì¸:</span><br>
                    1. ì´ë©”ì¼ì´ ì •í™•íˆ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ (ëŒ€ì†Œë¬¸ì, ê³µë°± í™•ì¸)<br>
                    2. Firestoreì— ë“±ë¡ëœ ì´ë©”ì¼ê³¼ ë‹¤ë¦„<br>
                    3. Adminì´ ë‹¤ë¥¸ ì´ë©”ì¼ë¡œ ì´ˆëŒ€í•¨<br>
                    4. ì´ˆëŒ€ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•ŠìŒ`;
                }
                
                document.getElementById('matching-result').innerHTML = html;
            } catch (error) {
                document.getElementById('matching-result').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function checkProjectMetadata() {
            try {
                const metadataStr = localStorage.getItem('negotiation-project-metadata');
                if (!metadataStr) {
                    document.getElementById('project-metadata').innerHTML = '<span class="warning">âš ï¸  í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</span>';
                    return;
                }
                
                const projects = JSON.parse(metadataStr);
                
                let html = `<span class="success">âœ… ì´ ${projects.length}ê°œì˜ í”„ë¡œì íŠ¸</span>`;
                html += '<table><tr><th>í”„ë¡œì íŠ¸ëª…</th><th>ë¸Œëœë“œ</th><th>ì°¸ì—¬ì</th><th>ìƒì„±ì¼</th></tr>';
                
                projects.forEach(project => {
                    html += `<tr>
                        <td>${project.name}</td>
                        <td>${project.brand}</td>
                        <td>
                            ${project.participants && project.participants.length > 0 
                                ? project.participants.map(p => `<div>${p}</div>`).join('')
                                : '<span class="warning">ì°¸ì—¬ì ì—†ìŒ</span>'}
                        </td>
                        <td>${new Date(project.createdAt).toLocaleString('ko-KR')}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('project-metadata').innerHTML = html;
            } catch (error) {
                document.getElementById('project-metadata').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function compareWithFirestore() {
            try {
                const firestoreInput = document.getElementById('firestore-users').value;
                if (!firestoreInput.trim()) {
                    document.getElementById('firestore-comparison').innerHTML = '<span class="warning">âš ï¸  Firestore ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>';
                    return;
                }
                
                const firestoreUsers = JSON.parse(firestoreInput);
                const invitationsStr = localStorage.getItem('project-invitations');
                const authStorage = localStorage.getItem('auth-storage');
                
                const auth = JSON.parse(authStorage);
                const currentUser = auth?.state?.appUser;
                const myEmail = currentUser?.email?.trim().toLowerCase();
                
                let html = '<h3>Firestore ì‚¬ìš©ì ëª©ë¡:</h3><table><tr><th>ì´ë©”ì¼</th><th>ì´ë¦„</th><th>ì—­í• </th><th>í˜„ì¬ ë¡œê·¸ì¸</th></tr>';
                
                firestoreUsers.forEach(user => {
                    const isMe = user.email.trim().toLowerCase() === myEmail;
                    html += `<tr class="${isMe ? 'match' : ''}">
                        <td>${user.email}</td>
                        <td>${user.name || 'N/A'}</td>
                        <td>${user.role || 'N/A'}</td>
                        <td>${isMe ? 'âœ… ë‚˜' : ''}</td>
                    </tr>`;
                });
                html += '</table>';
                
                if (invitationsStr) {
                    const invitations = JSON.parse(invitationsStr);
                    html += '<h3>ì´ˆëŒ€ ìƒíƒœ:</h3><table><tr><th>Firestore ì´ë©”ì¼</th><th>ì´ˆëŒ€ë¨?</th><th>í”„ë¡œì íŠ¸</th></tr>';
                    
                    firestoreUsers.forEach(user => {
                        const userEmail = user.email.trim().toLowerCase();
                        const userInvitations = invitations.filter(inv => 
                            inv.invitedEmail.trim().toLowerCase() === userEmail
                        );
                        
                        if (userInvitations.length > 0) {
                            html += `<tr class="match">
                                <td>${user.email}</td>
                                <td>âœ… ${userInvitations.length}ê°œ</td>
                                <td>${userInvitations.map(inv => inv.projectName).join(', ')}</td>
                            </tr>`;
                        } else {
                            html += `<tr class="nomatch">
                                <td>${user.email}</td>
                                <td>âŒ ì—†ìŒ</td>
                                <td>-</td>
                            </tr>`;
                        }
                    });
                    html += '</table>';
                }
                
                document.getElementById('firestore-comparison').innerHTML = html;
            } catch (error) {
                document.getElementById('firestore-comparison').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function createTestInvitation() {
            try {
                const email = document.getElementById('test-email').value.trim();
                if (!email) {
                    document.getElementById('test-result').innerHTML = '<span class="error">âŒ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”</span>';
                    return;
                }
                
                const authStorage = localStorage.getItem('auth-storage');
                const auth = JSON.parse(authStorage);
                const currentUser = auth?.state?.appUser;
                
                const invitation = {
                    notificationId: `test-inv-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    projectId: 'test-project-' + Date.now(),
                    projectName: 'Test Project',
                    brand: 'Test Brand',
                    invitedBy: currentUser?.email || 'Test Admin',
                    invitedAt: new Date().toISOString(),
                    invitedEmail: email.toLowerCase(),
                    isRead: false
                };
                
                const invitationsStr = localStorage.getItem('project-invitations');
                const invitations = invitationsStr ? JSON.parse(invitationsStr) : [];
                invitations.push(invitation);
                localStorage.setItem('project-invitations', JSON.stringify(invitations));
                
                document.getElementById('test-result').innerHTML = `
<span class="success">âœ… í…ŒìŠ¤íŠ¸ ì´ˆëŒ€ ìƒì„±ë¨!</span>

ì´ˆëŒ€ ì •ë³´:
${JSON.stringify(invitation, null, 2)}

<span class="info">ğŸ’¡ ì´ì œ ${email} ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì•Œë¦¼ì„ í™•ì¸í•˜ì„¸ìš”!</span>
                `;
            } catch (error) {
                document.getElementById('test-result').innerHTML = `<span class="error">âŒ ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        function clearInvitations() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ì´ˆëŒ€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('project-invitations');
                document.getElementById('clear-result').innerHTML = '<span class="success">âœ… ì´ˆëŒ€ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤</span>';
            }
        }

        function clearAllData() {
            if (confirm('âš ï¸ ê²½ê³ : ëª¨ë“  í”„ë¡œì íŠ¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!\n\nì •ë§ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('project-invitations');
                localStorage.removeItem('negotiation-project-metadata');
                document.getElementById('clear-result').innerHTML = '<span class="success">âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤</span>';
            }
        }
    </script>
</body>
</html>
